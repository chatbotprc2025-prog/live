{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/TECHNOSOFT/Downloads/test-main/PCE_Assistant-main/app/chat/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/navigation';\n\ninterface Message {\n  id: string;\n  sender: 'user' | 'assistant';\n  content: string;\n  createdAt: string;\n  images?: Array<{\n    url: string;\n    description?: string;\n    title?: string;\n  }>;\n}\n\ninterface Conversation {\n  id: string;\n  title: string;\n  updatedAt: string;\n  messages?: Message[];\n}\n\ninterface Source {\n  title: string;\n  snippet: string;\n  documentId?: string;\n}\n\n/**\n * Format message content for better readability\n */\nfunction formatMessageContent(content: string) {\n  // Split by double newlines (paragraphs)\n  const paragraphs = content.split(/\\n\\n+/).filter(p => p.trim());\n  \n  return paragraphs.map((paragraph, idx) => {\n    const trimmed = paragraph.trim();\n    \n    // Check if it's a list (starts with -, *, or number)\n    if (/^[-*‚Ä¢]\\s/.test(trimmed) || /^\\d+[.)]\\s/.test(trimmed)) {\n      const listItems = trimmed.split(/\\n(?=[-*‚Ä¢\\d])/).filter(item => item.trim());\n      return (\n        <ul key={idx} className=\"list-none space-y-1.5 my-2 pl-0\">\n          {listItems.map((item, itemIdx) => {\n            const cleanItem = item.replace(/^[-*‚Ä¢]\\s|^\\d+[.)]\\s/, '').trim();\n            return (\n              <li key={itemIdx} className=\"flex items-start gap-2\">\n                <span className=\"text-charcoal/60 mt-1.5 shrink-0\">‚Ä¢</span>\n                <span className=\"flex-1\">{cleanItem}</span>\n              </li>\n            );\n          })}\n        </ul>\n      );\n    }\n    \n    // Regular paragraph\n    const lines = trimmed.split('\\n').filter(line => line.trim());\n    return (\n      <p key={idx} className=\"mb-2 last:mb-0\">\n        {lines.map((line, lineIdx) => (\n          <span key={lineIdx}>\n            {line.trim()}\n            {lineIdx < lines.length - 1 && <br className=\"mb-1\" />}\n          </span>\n        ))}\n      </p>\n    );\n  });\n}\nexport default function ChatPage() {\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [filteredConversations, setFilteredConversations] = useState<Conversation[]>([]);\n  const [activeConversation, setActiveConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [inputMessage, setInputMessage] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [sources, setSources] = useState<Source[]>([]);\n  const [showPolicyBanner, setShowPolicyBanner] = useState(true);\n  const [isAuthorized, setIsAuthorized] = useState(false);\n  const [deletingConversationId, setDeletingConversationId] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [clientUser, setClientUser] = useState<{ email: string; userType: string } | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const router = useRouter();\n\n  useEffect(() => {\n    // Check if user has registered before allowing access to chat\n    const isLoggedIn = localStorage.getItem('clientUserLoggedIn');\n    const clientUserId = localStorage.getItem('clientUserId');\n    const clientUserEmail = localStorage.getItem('clientUserEmail') || '';\n    const clientUserType = localStorage.getItem('clientUserType') || 'student';\n    \n    // Redirect to login if not logged in or missing required data\n    if (isLoggedIn !== 'true' || !clientUserId) {\n      localStorage.removeItem('clientUserLoggedIn');\n      localStorage.removeItem('clientUserId');\n      localStorage.removeItem('clientUserType');\n      localStorage.removeItem('clientUserEmail');\n      router.push('/');\n      return;\n    }\n    setIsAuthorized(true);\n    setClientUser({ email: clientUserEmail, userType: clientUserType });\n    loadConversations();\n  }, [router]);\n\n  // Filter conversations based on search query\n  useEffect(() => {\n    if (!searchQuery.trim()) {\n      setFilteredConversations(conversations);\n    } else {\n      const query = searchQuery.toLowerCase();\n      const filtered = conversations.filter((conv) =>\n        conv.title.toLowerCase().includes(query)\n      );\n      setFilteredConversations(filtered);\n    }\n  }, [searchQuery, conversations]);\n\n  useEffect(() => {\n    if (activeConversation) {\n      loadConversationMessages(activeConversation.id);\n    }\n  }, [activeConversation]);\n\n  useEffect(() => {\n    // Scroll to bottom when messages change\n    const timeoutId = setTimeout(() => {\n      scrollToBottom();\n    }, 150);\n    return () => clearTimeout(timeoutId);\n  }, [messages, isLoading]);\n\n  const scrollToBottom = () => {\n    // Use requestAnimationFrame for better timing\n    requestAnimationFrame(() => {\n      const container = messagesContainerRef.current;\n      if (container) {\n        // Scroll to bottom immediately\n        container.scrollTop = container.scrollHeight;\n      }\n      // Also try the ref method as fallback\n      if (messagesEndRef.current) {\n        messagesEndRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });\n      }\n    });\n  };\n\n  const loadConversations = async () => {\n    try {\n      const res = await fetch('/api/conversations');\n      const data = await res.json();\n      const list = Array.isArray(data) ? data : [];\n      setConversations(list);\n      setFilteredConversations(list);\n      if (list.length > 0 && !activeConversation) {\n        setActiveConversation(list[0]);\n      }\n    } catch (error) {\n      console.error('Failed to load conversations:', error);\n    }\n  };\n\n  const handleDeleteConversation = async (conversationId: string) => {\n    const confirmed = window.confirm('Delete this conversation? This cannot be undone.');\n    if (!confirmed) return;\n\n    try {\n      setDeletingConversationId(conversationId);\n      const res = await fetch(`/api/conversations/${conversationId}`, {\n        method: 'DELETE',\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json().catch(() => ({ error: 'Failed to delete conversation' }));\n        throw new Error(errorData.error || `Server error: ${res.status}`);\n      }\n\n      setConversations((prev) => {\n        const updated = prev.filter((conv) => conv.id !== conversationId);\n        const deletedActive = activeConversation?.id === conversationId;\n\n        if (deletedActive) {\n          const nextActive = updated[0] || null;\n          setActiveConversation(nextActive);\n\n          if (nextActive) {\n            loadConversationMessages(nextActive.id);\n          } else {\n            setMessages([]);\n            setSources([]);\n          }\n        }\n\n        return updated;\n      });\n      // Refresh from server to keep ordering/metadata in sync\n      loadConversations();\n    } catch (error: any) {\n      console.error('Failed to delete conversation:', error);\n      alert(error.message || 'Failed to delete conversation. Please try again.');\n    } finally {\n      setDeletingConversationId(null);\n    }\n  };\n\n  const loadConversationMessages = async (conversationId: string) => {\n    try {\n      const res = await fetch(`/api/conversations/${conversationId}`);\n      const data = await res.json();\n      \n      // Process messages to ensure images are properly formatted\n      const processedMessages = (data.messages || []).map((msg: any) => {\n        let images = undefined;\n        \n        // Handle images - could be array (from API) or string (from DB that needs parsing)\n        if (msg.images) {\n          if (typeof msg.images === 'string') {\n            try {\n              images = JSON.parse(msg.images);\n            } catch (e) {\n              console.warn('Failed to parse images JSON:', e);\n              images = undefined;\n            }\n          } else if (Array.isArray(msg.images)) {\n            images = msg.images;\n          }\n          \n          // Filter valid images\n          if (images && Array.isArray(images) && images.length > 0) {\n            images = images.filter((img: any) => img && img.url && typeof img.url === 'string' && img.url.trim().length > 0);\n            if (images.length === 0) {\n              images = undefined;\n            }\n          } else {\n            images = undefined;\n          }\n        }\n        \n        return {\n          ...msg,\n          images,\n        };\n      });\n      \n      console.log('üì• Loaded messages with images:', processedMessages.filter((m: any) => m.images).length);\n      setMessages(processedMessages);\n      setSources([]);\n      // Scroll to bottom after loading messages\n      setTimeout(() => scrollToBottom(), 300);\n    } catch (error) {\n      console.error('Failed to load messages:', error);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!inputMessage.trim() || isLoading) return;\n\n    const userMessage = inputMessage.trim();\n    setInputMessage('');\n    setIsLoading(true);\n\n    // Add user message to UI immediately\n    const tempUserMessage: Message = {\n      id: `temp-${Date.now()}`,\n      sender: 'user',\n      content: userMessage,\n      createdAt: new Date().toISOString(),\n    };\n    setMessages(prev => [...prev, tempUserMessage]);\n\n    // Scroll after adding user message\n    setTimeout(() => scrollToBottom(), 100);\n\n    try {\n      const res = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          message: userMessage,\n          conversationId: activeConversation?.id,\n        }),\n      });\n\n       if (!res.ok) {\n        const errorData = await res.json().catch(() => ({ error: 'Failed to get response' }));\n        throw new Error(errorData.error || `Server error: ${res.status}`);\n      }\n\n      const data = await res.json();\n\n      if (!data.answer) {\n        throw new Error('No answer received from server');\n      }\n\n      // Remove temp user message and add real one\n      setMessages(prev => prev.filter(m => m.id !== tempUserMessage.id));\n      \n      // Add user message back (will be saved by API)\n      setMessages(prev => [...prev, tempUserMessage]);\n\n      // Add assistant response with images if available\n      console.log('Received data from API:', { \n        hasAnswer: !!data.answer, \n        hasImages: !!data.images, \n        imageCount: data.images?.length || 0,\n        images: data.images \n      });\n      \n      // Process images to ensure they're valid\n      let processedImages = undefined;\n      if (data.images && Array.isArray(data.images) && data.images.length > 0) {\n        processedImages = data.images\n          .filter((img: any) => {\n            const isValid = img && img.url && typeof img.url === 'string' && img.url.trim().length > 0;\n            if (!isValid) {\n              console.warn('Invalid image object filtered out:', img);\n            }\n            return isValid;\n          })\n          .map((img: any) => ({\n            url: img.url.trim(),\n            description: img.description || img.title || undefined,\n            title: img.title || undefined,\n          }));\n        if (processedImages.length === 0) {\n          processedImages = undefined;\n        } else {\n          console.log('‚úÖ Processed images for display:', processedImages);\n        }\n      } else {\n        console.log('‚ö†Ô∏è No images in response or empty array');\n      }\n      \n      const assistantMessage: Message = {\n        id: `msg-${Date.now()}`,\n        sender: 'assistant',\n        content: data.answer || 'Sorry, I could not generate a response. Please try again.',\n        createdAt: new Date().toISOString(),\n        images: processedImages,\n      };\n      \n      console.log('üìù Assistant message created:', {\n        hasImages: !!assistantMessage.images,\n        imageCount: assistantMessage.images?.length || 0,\n        messageId: assistantMessage.id,\n        images: assistantMessage.images,\n      });\n      \n      // Add message with images - ensure images persist\n      setMessages(prev => {\n        const updated = [...prev, assistantMessage];\n        console.log('üìã Messages after adding:', updated.length, 'messages, last one has images:', !!updated[updated.length - 1].images);\n        return updated;\n      });\n\n      // Set sources if available\n       if (data.sources && Array.isArray(data.sources)) {\n        setSources(data.sources);\n      } else {\n        setSources([]);\n      }\n\n      // Ensure scroll happens after message is added\n      setTimeout(() => scrollToBottom(), 300);\n\n       // Update active conversation\n      if (data.conversationId) {\n        const updatedConv: Conversation = {\n          id: data.conversationId,\n          title: activeConversation?.title || userMessage.substring(0, 50),\n          updatedAt: new Date().toISOString(),\n        };\n        setActiveConversation(updatedConv);\n        loadConversations();\n      }\n     } catch (error: any) {\n      console.error('Failed to send message:', error);\n      \n      // Remove temp user message on error\n      setMessages(prev => prev.filter(m => m.id !== tempUserMessage.id));\n      \n      // Add error message\n      const errorMessage: Message = {\n        id: `error-${Date.now()}`,\n        sender: 'assistant',\n        content: `Sorry, I encountered an error: ${error.message || 'Unknown error'}. Please try again.`,\n        createdAt: new Date().toISOString(),\n      };\n      setMessages(prev => [...prev, errorMessage]);\n      setTimeout(() => scrollToBottom(), 200);\n     } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    setInputMessage(suggestion);\n  };\n\n  const handleNewConversation = async () => {\n    try {\n      const res = await fetch('/api/conversations', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          title: 'New Conversation',\n        }),\n      });\n\n      if (!res.ok) {\n        throw new Error('Failed to create conversation');\n      }\n\n      const newConversation = await res.json();\n      \n      // Clear current messages\n      setMessages([]);\n      setSources([]);\n      \n      // Set new conversation as active\n      setActiveConversation(newConversation);\n      \n      // Reload conversations list\n      await loadConversations();\n    } catch (error: any) {\n      console.error('Failed to create conversation:', error);\n      alert(error.message || 'Failed to create new conversation. Please try again.');\n    }\n  };\n\n  const quickLinks = [\n    { icon: 'school', label: 'Academics' },\n    { icon: 'calendar_month', label: 'Timetable' },\n    { icon: 'receipt_long', label: 'Fees' },\n    { icon: 'local_library', label: 'Library' },\n    { icon: 'map', label: 'Campus Map' },\n    { icon: 'contacts', label: 'Contacts' },\n  ];\n\n  if (!isAuthorized) {\n    return (\n      <div className=\"flex h-screen w-full items-center justify-center\" style={{ background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)' }}>\n        <div className=\"text-center\">\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4\"></div>\n          <p className=\"text-gray-700 font-medium\">Checking registration...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-screen w-full relative overflow-hidden\" style={{ background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)' }}>\n      {/* Left Sidebar - Conversations - Glassmorphic */}\n      <aside className=\"hidden lg:flex w-[320px] flex-col glass-card border-r\" style={{ background: 'rgba(255, 255, 255, 0.25)', backdropFilter: 'blur(20px)', borderColor: 'rgba(255, 255, 255, 0.18)' }}>\n        <div className=\"shrink-0 p-4\">\n          <div className=\"flex items-center gap-3 px-2 pt-2 pb-4\">\n            <div className=\"flex h-12 w-12 items-center justify-center rounded-2xl relative overflow-hidden animate-float\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 8px 30px rgba(102, 126, 234, 0.4)' }}>\n              <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n              <p className=\"text-xl font-bold text-white relative z-10\">PCE</p>\n            </div>\n            <p className=\"text-charcoal text-lg font-bold gradient-text\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>PCE Assistant</p>\n          </div>\n          <div className=\"relative\">\n            <span className=\"material-symbols-outlined pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-charcoal/60 z-10\">\n              search\n            </span>\n            <input\n              className=\"modern-input w-full rounded-2xl py-3 pl-10 pr-4 text-sm text-charcoal placeholder-charcoal/60\"\n              placeholder=\"Search conversations...\"\n              type=\"text\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n          </div>\n        </div>\n        <div className=\"flex-1 space-y-4 overflow-y-auto px-4\">\n          <div>\n            <div className=\"flex items-center justify-between px-2 mb-2\">\n              <h3 className=\"text-xs font-semibold uppercase tracking-wider text-charcoal/50\">\n                Conversations\n              </h3>\n              <button\n                onClick={handleNewConversation}\n                className=\"flex items-center justify-center w-7 h-7 rounded-full text-white shadow-md hover:shadow-lg transition-all duration-200 hover:scale-110\"\n                style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 4px 15px rgba(102, 126, 234, 0.4)' }}\n                title=\"New Conversation\"\n              >\n                <span className=\"material-symbols-outlined text-base\">add</span>\n              </button>\n            </div>\n            <ul className=\"flex flex-col gap-1\">\n              {filteredConversations.length === 0 && searchQuery ? (\n                <li className=\"px-3 py-4 text-sm text-charcoal/60 text-center\">\n                  No conversations found matching \"{searchQuery}\"\n                </li>\n              ) : (\n                filteredConversations.map((conv) => (\n                <li\n                  key={conv.id}\n                  onClick={() => setActiveConversation(conv)}\n                  className={`flex h-12 cursor-pointer items-center gap-3 rounded-xl px-3 transition-all hover-lift ${\n                    activeConversation?.id === conv.id\n                      ? 'neu-card-inset'\n                      : 'hover:bg-white/20'\n                  }`}\n                  style={activeConversation?.id === conv.id ? { background: 'rgba(102, 126, 234, 0.15)', boxShadow: 'inset 4px 4px 8px rgba(163, 177, 198, 0.2), inset -4px -4px 8px rgba(255, 255, 255, 0.8)' } : {}}\n                >\n                  <span\n                    className={`material-symbols-outlined text-[22px] ${\n                      activeConversation?.id === conv.id ? 'text-primary' : 'text-charcoal/80'\n                    }`}\n                  >\n                    chat_bubble\n                  </span>\n                  <div className=\"flex-1 min-w-0\">\n                    <p\n                      className={`text-sm leading-tight truncate ${\n                        activeConversation?.id === conv.id\n                          ? 'text-primary font-semibold'\n                          : 'text-charcoal font-medium'\n                      }`}\n                    >\n                      {conv.title}\n                    </p>\n                  </div>\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleDeleteConversation(conv.id);\n                    }}\n                    disabled={deletingConversationId === conv.id}\n                    className=\"flex size-8 items-center justify-center rounded-lg transition-colors hover:bg-white/30 text-charcoal/70 disabled:opacity-50\"\n                    title=\"Delete conversation\"\n                  >\n                    <span className=\"material-symbols-outlined text-[18px]\">delete</span>\n                  </button>\n                </li>\n                ))\n              )}\n            </ul>\n          </div>\n          <div>\n            <h3 className=\"px-2 text-xs font-semibold uppercase tracking-wider text-charcoal/50 mb-2\">\n              Quick Links\n            </h3>\n            <ul className=\"flex flex-col gap-1\">\n              {quickLinks.map((link) => (\n                <li\n                  key={link.label}\n                  className=\"flex h-12 cursor-pointer items-center gap-3 rounded-xl px-3 transition-all hover-lift hover:bg-white/20\"\n                >\n                  <span className=\"material-symbols-outlined text-charcoal/80 text-[22px]\">\n                    {link.icon}\n                  </span>\n                  <p className=\"text-charcoal text-sm font-medium leading-tight truncate\">\n                    {link.label}\n                  </p>\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n        {/* User Info Card and Settings Button */}\n        <div className=\"p-4 border-t\" style={{ borderColor: 'rgba(255, 255, 255, 0.18)' }}>\n          <div className=\"mb-3 p-3 rounded-xl glass-card\" style={{ background: 'rgba(255, 255, 255, 0.2)', backdropFilter: 'blur(10px)' }}>\n            <p className=\"text-xs text-gray-500 mb-1\">Logged in as</p>\n            <p className=\"text-sm font-semibold text-charcoal truncate\">{clientUser?.email || 'Student'}</p>\n            {clientUser?.userType && (\n              <p className=\"text-xs text-gray-500 mt-1 capitalize\">{clientUser.userType}</p>\n            )}\n          </div>\n          <Link\n            href=\"/settings\"\n            className=\"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-semibold text-white hover-lift transition-all\"\n            style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 4px 15px rgba(102, 126, 234, 0.3)' }}\n          >\n            <span className=\"material-symbols-outlined text-lg\">settings</span>\n            <span>Settings</span>\n          </Link>\n        </div>\n      </aside>\n\n      {/* Main Chat Area */}\n      <div className=\"flex flex-1 flex-col relative\">\n        <header className=\"flex shrink-0 items-center justify-between glass-card p-4\" style={{ background: 'rgba(255, 255, 255, 0.3)', backdropFilter: 'blur(20px)', borderBottom: '1px solid rgba(255, 255, 255, 0.18)' }}>\n          <button className=\"flex size-10 items-center justify-center text-charcoal lg:hidden\">\n            <span className=\"material-symbols-outlined text-2xl\">menu</span>\n          </button>\n          <h1 className=\"text-charcoal text-lg font-bold leading-tight gradient-text\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>\n            {activeConversation?.title || 'Campus Assistant'}\n          </h1>\n          <div className=\"w-12\" />\n        </header>\n\n        <main\n          ref={messagesContainerRef}\n           className=\"flex-1 overflow-y-auto p-4 pb-24 space-y-6 scroll-smooth\"\n          style={{ \n            maxHeight: 'calc(100vh - 140px)',\n            scrollBehavior: 'smooth',\n            WebkitOverflowScrolling: 'touch'\n          }}\n         >\n          {showPolicyBanner && (\n            <div className=\"flex items-center justify-between rounded-2xl glass-card p-4 animate-slide-up\" style={{ background: 'rgba(255, 255, 255, 0.4)', backdropFilter: 'blur(15px)', border: '1px solid rgba(255, 255, 255, 0.3)' }}>\n              <div className=\"flex flex-col gap-1\">\n                <p className=\"text-charcoal text-sm font-semibold leading-tight\">\n                  Policy Information\n                </p>\n                <p className=\"text-gray-500 text-sm font-normal leading-normal\">\n                  Your conversations help improve our service. Please don't share personal information.\n                </p>\n              </div>\n              <button\n                onClick={() => setShowPolicyBanner(false)}\n                className=\"text-sm font-medium leading-normal text-gray-500 hover:text-charcoal\"\n              >\n                Dismiss\n              </button>\n            </div>\n          )}\n\n          {messages.length === 0 && (\n            <div className=\"flex items-end gap-3 animate-fade-in\">\n              <div className=\"bg-center bg-no-repeat aspect-square bg-cover rounded-full w-12 shrink-0 relative overflow-hidden animate-float flex items-center justify-center\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 8px 30px rgba(102, 126, 234, 0.4)' }}>\n                <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n                <span className=\"material-symbols-outlined text-white relative z-10 text-2xl\">support_agent</span>\n              </div>\n              <div className=\"flex flex-1 flex-col gap-1.5 items-start\">\n                <p className=\"text-charcoal/70 text-[13px] font-medium leading-normal max-w-[360px]\">\n                  Campus Assistant\n                </p>\n                <div className=\"flex flex-col gap-2 items-start\">\n                  <p className=\"chat-bubble-assistant text-base font-normal leading-normal flex max-w-[360px] rounded-2xl rounded-bl-none px-5 py-4 text-charcoal\">\n                    Hello! I'm the PCE Campus Assistant. How can I help you today? You can ask me about library hours, fee deadlines, and more.\n                  </p>\n                  <div className=\"flex flex-wrap gap-2 pt-1\">\n                    <button\n                      onClick={() => handleSuggestionClick('What are the library hours?')}\n                      className=\"rounded-xl glass-card px-4 py-2 text-sm text-charcoal hover-lift transition-all\"\n                      style={{ background: 'rgba(255, 255, 255, 0.3)', backdropFilter: 'blur(10px)' }}\n                    >\n                      What are the library hours?\n                    </button>\n                    <button\n                      onClick={() => handleSuggestionClick('When is the fee deadline?')}\n                      className=\"rounded-xl glass-card px-4 py-2 text-sm text-charcoal hover-lift transition-all\"\n                      style={{ background: 'rgba(255, 255, 255, 0.3)', backdropFilter: 'blur(10px)' }}\n                    >\n                      When is the fee deadline?\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex items-end gap-3 ${message.sender === 'user' ? 'justify-end' : ''}`}\n            >\n              {message.sender === 'assistant' && (\n                <div className=\"bg-center bg-no-repeat aspect-square bg-cover rounded-full w-12 shrink-0 relative overflow-hidden flex items-center justify-center\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 8px 30px rgba(102, 126, 234, 0.3)' }}>\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n                  <span className=\"material-symbols-outlined text-white relative z-10 text-xl\">support_agent</span>\n                </div>\n              )}\n              <div\n                className={`flex flex-1 flex-col gap-1.5 items-${message.sender === 'user' ? 'end' : 'start'}`}\n              >\n                <p\n                  className={`text-charcoal/70 text-[13px] font-medium leading-normal max-w-[360px] ${\n                    message.sender === 'user' ? 'text-right' : ''\n                  }`}\n                >\n                  {message.sender === 'user' ? 'You' : 'Campus Assistant'}\n                </p>\n                 <div\n                  className={`text-base font-normal leading-relaxed flex max-w-[360px] rounded-2xl px-5 py-4 shadow-soft animate-slide-up break-words ${\n                     message.sender === 'user'\n                      ? 'chat-bubble-user text-white rounded-br-none'\n                      : 'chat-bubble-assistant text-charcoal rounded-bl-none'\n                  }`}\n                   style={message.sender === 'user' ? { background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 10px 40px rgba(102, 126, 234, 0.3)' } : { lineHeight: '1.7' }}\n                >\n                  <div className=\"w-full space-y-2.5\">\n                    {formatMessageContent(message.content)}\n                  </div>\n                </div>\n                {/* Display images if available - simplified, no extras */}\n                {message.sender === 'assistant' && message.images && Array.isArray(message.images) && message.images.length > 0 && (\n                  <div className=\"flex flex-col gap-2 mt-2\">\n                    {message.images.map((img, idx) => {\n                      if (!img || !img.url) {\n                        console.warn('Invalid image object:', img);\n                        return null;\n                      }\n                      \n                      // Ensure URL is properly formatted\n                      let imageUrl = String(img.url).trim();\n                      if (!imageUrl) {\n                        return null;\n                      }\n                      \n                      // Ensure URL starts with / for proper path resolution\n                      if (!imageUrl.startsWith('/') && !imageUrl.startsWith('http')) {\n                        imageUrl = '/' + imageUrl;\n                      }\n                      \n                      console.log('üñºÔ∏è Rendering image:', { idx, imageUrl, messageId: message.id });\n                      \n                      return (\n                        <img\n                          key={`img-${message.id}-${idx}`}\n                          src={imageUrl}\n                          alt={img.description || img.title || 'Knowledge base image'}\n                          className=\"max-w-[400px] h-auto rounded-lg shadow-sm\"\n                          loading=\"lazy\"\n                          onError={(e) => {\n                            console.error('‚ùå Image failed to load:', imageUrl, 'Full img object:', img);\n                            const target = e.target as HTMLImageElement;\n                            target.style.border = '2px solid red';\n                            target.alt = 'Failed to load: ' + imageUrl;\n                          }}\n                          onLoad={() => {\n                            console.log('‚úÖ Image loaded successfully:', imageUrl);\n                          }}\n                        />\n                      );\n                    })}\n                  </div>\n                )}\n               </div>\n              {message.sender === 'user' && (\n                <div className=\"bg-center bg-no-repeat aspect-square bg-cover rounded-full w-12 shrink-0 relative overflow-hidden flex items-center justify-center\" style={{ background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', boxShadow: '0 8px 30px rgba(79, 172, 254, 0.3)' }}>\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n                  <span className=\"material-symbols-outlined text-white relative z-10 text-xl\">person</span>\n                </div>\n              )}\n            </div>\n          ))}\n\n          {isLoading && (\n            <div className=\"flex items-end gap-3\">\n              <div className=\"bg-center bg-no-repeat aspect-square bg-cover rounded-full w-12 shrink-0 relative overflow-hidden flex items-center justify-center\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 8px 30px rgba(102, 126, 234, 0.3)' }}>\n                <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n                <span className=\"material-symbols-outlined text-white relative z-10 text-xl\">support_agent</span>\n              </div>\n              <div className=\"flex items-center justify-center rounded-2xl rounded-bl-none px-5 py-4 glass-card\" style={{ background: 'rgba(255, 255, 255, 0.4)', backdropFilter: 'blur(15px)' }}>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"size-2 rounded-full animate-[pulse_1.5s_cubic-bezier(0.4,0,0.6,1)_infinite]\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}></span>\n                  <span className=\"size-2 rounded-full animate-[pulse_1.5s_cubic-bezier(0.4,0,0.6,1)_infinite_0.2s]\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}></span>\n                  <span className=\"size-2 rounded-full animate-[pulse_1.5s_cubic-bezier(0.4,0,0.6,1)_infinite_0.4s]\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}></span>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {sources.length > 0 && (\n            <div className=\"flex flex-col gap-3 ml-12\">\n              <h3 className=\"text-charcoal/80 text-sm font-bold leading-tight tracking-[-0.015em] px-1 pt-2\">\n                Sources\n              </h3>\n              <div className=\"flex flex-col items-stretch justify-start rounded-2xl glass-card overflow-hidden animate-slide-up\" style={{ background: 'rgba(255, 255, 255, 0.4)', backdropFilter: 'blur(15px)', border: '1px solid rgba(255, 255, 255, 0.3)' }}>\n                {sources.map((source, index) => (\n                  <div\n                    key={index}\n                    className={`flex w-full min-w-72 grow flex-col items-stretch justify-center gap-2 p-4 ${\n                      index < sources.length - 1 ? 'border-b border-soft-gray/50' : ''\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"flex items-center justify-center size-7 rounded-full font-semibold text-xs text-white relative overflow-hidden\" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', boxShadow: '0 4px 15px rgba(102, 126, 234, 0.3)' }}>\n                        <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent\"></div>\n                        <span className=\"relative z-10\">{index + 1}</span>\n                      </div>\n                      <p className=\"text-primary text-sm font-semibold leading-normal flex-1\">\n                        {source.title}\n                      </p>\n                    </div>\n                    <p className=\"text-charcoal text-sm font-normal leading-normal pl-9\">\n                      {source.snippet}\n                    </p>\n                    <div className=\"flex items-end gap-3 justify-end pt-1\">\n                      <button className=\"flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden h-9 px-4 text-charcoal text-sm font-medium leading-normal rounded-xl hover-lift transition-all\" style={{ background: 'rgba(255, 255, 255, 0.3)', backdropFilter: 'blur(10px)' }}>\n                        <span className=\"truncate\">View document</span>\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n           <div ref={messagesEndRef} style={{ height: '1px' }} />\n         </main>\n\n        <footer className=\"absolute bottom-0 left-0 right-0 glass-card\" style={{ background: 'rgba(255, 255, 255, 0.3)', backdropFilter: 'blur(20px)', borderTop: '1px solid rgba(255, 255, 255, 0.18)' }}>\n          <div className=\"flex items-center gap-3 p-4\">\n            <input\n              value={inputMessage}\n              onChange={(e) => setInputMessage(e.target.value)}\n              onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n              className=\"modern-input w-full rounded-2xl py-4 px-5 text-charcoal placeholder-charcoal/60\"\n              placeholder=\"Ask about exams, timetables, admissions...\"\n              type=\"text\"\n            />\n            <button\n              onClick={handleSendMessage}\n              disabled={isLoading}\n              className=\"btn-primary flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl text-white relative overflow-hidden group disabled:opacity-50\"\n              style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}\n            >\n              <span className=\"material-symbols-outlined relative z-10\">send</span>\n              <div className=\"absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n            </button>\n          </div>\n        </footer>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}