{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/TECHNOSOFT/Downloads/test-main/PCE_Assistant-main/app/admin/client-users/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ntype UserType = 'all' | 'student' | 'guest' | 'parent';\n\ninterface ClientUser {\n  id: string;\n  mobile: string;\n  email: string;\n  userType: string;\n  createdAt: string;\n}\n\nexport default function ClientUsersPage() {\n  const [users, setUsers] = useState<ClientUser[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [filter, setFilter] = useState<UserType>('all');\n  const [selectedUser, setSelectedUser] = useState<ClientUser | null>(null);\n  const [error, setError] = useState('');\n  const [deletingUserId, setDeletingUserId] = useState<string | null>(null);\n\n  // Fetch users based on filter\n  useEffect(() => {\n    const fetchUsers = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        const url = filter === 'all' \n          ? '/api/admin/client-users'\n          : `/api/admin/client-users?userType=${filter}`;\n        \n        const response = await fetch(url);\n        if (!response.ok) throw new Error('Failed to fetch users');\n        \n        const data = await response.json();\n        setUsers(data.users || []);\n      } catch (err: any) {\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchUsers();\n  }, [filter]);\n\n  // Download CSV\n  const handleDownloadCSV = async () => {\n    try {\n      const url = filter === 'all'\n        ? '/api/admin/client-users/download'\n        : `/api/admin/client-users/download?userType=${filter}`;\n      \n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to download CSV');\n\n      const blob = await response.blob();\n      const csvUrl = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = csvUrl;\n      a.download = `client-users-${new Date().toISOString().split('T')[0]}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(csvUrl);\n      document.body.removeChild(a);\n    } catch (err: any) {\n      setError(err.message);\n    }\n  };\n\n  // Delete user\n  const handleDeleteUser = async (userId: string) => {\n    if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      setDeletingUserId(userId);\n      setError('');\n      \n      const response = await fetch(`/api/admin/client-users/${userId}`, {\n        method: 'DELETE',\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ error: 'Failed to delete user' }));\n        throw new Error(errorData.error || `Server error: ${response.status}`);\n      }\n\n      // Remove user from list\n      setUsers(prev => prev.filter(u => u.id !== userId));\n      \n      // Close detail drawer if it was open for this user\n      if (selectedUser?.id === userId) {\n        setSelectedUser(null);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete user');\n    } finally {\n      setDeletingUserId(null);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\">Registered Clients</h1>\n          <p className=\"text-gray-600 mt-2\">Manage and view all client user registrations</p>\n        </div>\n\n        {/* Controls */}\n        <div className=\"bg-white rounded-lg shadow mb-6 p-6\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n            {/* Filter Tabs */}\n            <div className=\"flex gap-2 flex-wrap\">\n              {(['all', 'student', 'guest', 'parent'] as const).map((type) => (\n                <button\n                  key={type}\n                  onClick={() => {\n                    setFilter(type);\n                    setSelectedUser(null);\n                  }}\n                  className={`px-4 py-2 rounded-lg font-medium transition-all ${\n                    filter === type\n                      ? 'bg-blue-600 text-white shadow-lg'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  {type === 'all' ? 'All Users' : type.charAt(0).toUpperCase() + type.slice(1)}\n                  {users.length > 0 && filter === type && ` (${users.length})`}\n                </button>\n              ))}\n            </div>\n\n            {/* Download Button */}\n            <button\n              onClick={handleDownloadCSV}\n              disabled={loading || users.length === 0}\n              className=\"px-6 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-400 transition-all\"\n            >\n              ðŸ“¥ Download CSV\n            </button>\n          </div>\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm\">\n              {error}\n            </div>\n          )}\n        </div>\n\n        {/* Users Table */}\n        <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n          {loading ? (\n            <div className=\"p-12 text-center\">\n              <p className=\"text-gray-600\">Loading users...</p>\n            </div>\n          ) : users.length === 0 ? (\n            <div className=\"p-12 text-center\">\n              <p className=\"text-gray-600\">No users found for this filter</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead className=\"bg-gray-100 border-b border-gray-200\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-sm font-semibold text-gray-900\">Mobile</th>\n                    <th className=\"px-6 py-3 text-left text-sm font-semibold text-gray-900\">Email</th>\n                    <th className=\"px-6 py-3 text-left text-sm font-semibold text-gray-900\">Type</th>\n                    <th className=\"px-6 py-3 text-left text-sm font-semibold text-gray-900\">Registered</th>\n                    <th className=\"px-6 py-3 text-left text-sm font-semibold text-gray-900\">Action</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {users.map((user) => (\n                    <tr\n                      key={user.id}\n                      className=\"border-b border-gray-200 hover:bg-gray-50 transition-colors\"\n                    >\n                      <td className=\"px-6 py-4 text-sm text-gray-900\">{user.mobile}</td>\n                      <td className=\"px-6 py-4 text-sm text-gray-700\">{user.email}</td>\n                      <td className=\"px-6 py-4 text-sm\">\n                        <span className={`px-3 py-1 rounded-full text-xs font-medium ${\n                          user.userType === 'student' ? 'bg-blue-100 text-blue-800' :\n                          user.userType === 'guest' ? 'bg-yellow-100 text-yellow-800' :\n                          user.userType === 'parent' ? 'bg-purple-100 text-purple-800' :\n                          'bg-gray-100 text-gray-800'\n                        }`}>\n                          {user.userType.charAt(0).toUpperCase() + user.userType.slice(1)}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 text-sm text-gray-600\">\n                        {new Date(user.createdAt).toLocaleDateString()} {new Date(user.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                      </td>\n                      <td className=\"px-6 py-4 text-sm\">\n                        <div className=\"flex items-center gap-3\">\n                          <button\n                            onClick={() => setSelectedUser(user)}\n                            className=\"text-blue-600 hover:text-blue-800 font-medium\"\n                          >\n                            View\n                          </button>\n                          <button\n                            onClick={() => handleDeleteUser(user.id)}\n                            disabled={deletingUserId === user.id}\n                            className=\"text-red-600 hover:text-red-800 font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n                          >\n                            {deletingUserId === user.id ? 'Deleting...' : 'Delete'}\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n\n          {/* Stats Footer */}\n          {users.length > 0 && (\n            <div className=\"px-6 py-4 bg-gray-50 border-t border-gray-200 text-sm text-gray-600\">\n              Showing {users.length} user{users.length !== 1 ? 's' : ''}\n              {filter !== 'all' && ` (${filter})`}\n            </div>\n          )}\n        </div>\n\n        {/* Detail Drawer */}\n        {selectedUser && (\n          <div className=\"fixed inset-0 bg-black/50 flex items-end z-50\">\n            <div className=\"bg-white w-full max-w-md rounded-t-2xl shadow-2xl animate-slide-up\">\n              <div className=\"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center rounded-t-2xl\">\n                <h2 className=\"text-xl font-bold text-gray-900\">User Details</h2>\n                <button\n                  onClick={() => setSelectedUser(null)}\n                  className=\"text-gray-600 hover:text-gray-900 text-2xl\"\n                >\n                  Ã—\n                </button>\n              </div>\n\n              <div className=\"p-6 space-y-6\">\n                {/* User Type Badge */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-600 mb-2\">User Type</label>\n                  <span className={`px-4 py-2 rounded-full text-sm font-medium inline-block ${\n                    selectedUser.userType === 'student' ? 'bg-blue-100 text-blue-800' :\n                    selectedUser.userType === 'guest' ? 'bg-yellow-100 text-yellow-800' :\n                    selectedUser.userType === 'parent' ? 'bg-purple-100 text-purple-800' :\n                    'bg-gray-100 text-gray-800'\n                  }`}>\n                    {selectedUser.userType.charAt(0).toUpperCase() + selectedUser.userType.slice(1)}\n                  </span>\n                </div>\n\n                {/* Mobile */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-600 mb-2\">Mobile Number</label>\n                  <p className=\"text-lg text-gray-900 font-mono\">{selectedUser.mobile}</p>\n                </div>\n\n                {/* Email */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-600 mb-2\">Email</label>\n                  <p className=\"text-lg text-gray-900 break-all\">{selectedUser.email}</p>\n                </div>\n\n                {/* Registration Date */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-600 mb-2\">Registered On</label>\n                  <p className=\"text-lg text-gray-900\">\n                    {new Date(selectedUser.createdAt).toLocaleDateString('en-US', {\n                      year: 'numeric',\n                      month: 'long',\n                      day: 'numeric',\n                      hour: '2-digit',\n                      minute: '2-digit',\n                      second: '2-digit',\n                    })}\n                  </p>\n                </div>\n\n                {/* ID */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-600 mb-2\">User ID</label>\n                  <p className=\"text-sm text-gray-700 font-mono break-all bg-gray-100 p-3 rounded\">\n                    {selectedUser.id}\n                  </p>\n                </div>\n\n                {/* Close Button */}\n                <button\n                  onClick={() => setSelectedUser(null)}\n                  className=\"w-full mt-8 px-4 py-3 bg-gray-100 text-gray-900 rounded-lg font-medium hover:bg-gray-200 transition-colors\"\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}