{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/TECHNOSOFT/Downloads/test-main/PCE_Assistant-main/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\n// Lazy initialization - only create client when first accessed\nfunction getPrismaClient(): PrismaClient {\n  if (globalForPrisma.prisma) {\n    return globalForPrisma.prisma;\n  }\n\n  // Safely get and clean DATABASE_URL\n  const rawDatabaseUrl = process.env.DATABASE_URL;\n  if (!rawDatabaseUrl || typeof rawDatabaseUrl !== 'string') {\n    throw new Error('DATABASE_URL environment variable is not set. Please add it to your .env file.');\n  }\n  \n  // Ensure it's a string and clean it\n  let databaseUrl: string;\n  try {\n    databaseUrl = String(rawDatabaseUrl).trim();\n    if (databaseUrl) {\n      databaseUrl = databaseUrl.replace(/^[\"']|[\"']$/g, '');\n    }\n  } catch (error) {\n    throw new Error(`Failed to parse DATABASE_URL: ${error}`);\n  }\n  \n  if (!databaseUrl) {\n    throw new Error('DATABASE_URL is empty after parsing.');\n  }\n  let client: PrismaClient;\n\n  if (databaseUrl && databaseUrl.startsWith('file:')) {\n    // SQLite - use better-sqlite3 adapter (required for Prisma 7)\n    try {\n      const { PrismaBetterSqlite3 } = require('@prisma/adapter-better-sqlite3');\n      const Database = require('better-sqlite3');\n      const path = require('path');\n      \n      // Extract database path from DATABASE_URL\n      // Format: \"file:./prisma/dev.db\" or \"file:///absolute/path\" or \"file://relative/path\"\n      let dbPath = databaseUrl.replace(/^file:/i, '').replace(/^\\/+/, '');\n      dbPath = dbPath.replace(/^[\"']|[\"']$/g, ''); // Remove quotes\n      \n      // Handle relative paths\n      if (dbPath.startsWith('./')) {\n        dbPath = dbPath.substring(2);\n      }\n      \n      // Resolve to absolute path\n      const absolutePath = path.resolve(process.cwd(), dbPath);\n      \n      // Create adapter - pass config object with url property\n      const adapter = new PrismaBetterSqlite3({\n        url: absolutePath,\n      });\n      \n      client = new PrismaClient({\n        adapter,\n        log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : [],\n      });\n    } catch (error: any) {\n      console.error('Failed to initialize SQLite with adapter:', error);\n      console.error('Database URL:', databaseUrl);\n      console.error('Error details:', error?.message, error?.stack);\n      throw new Error(`Failed to initialize Prisma with SQLite: ${error?.message || error}`);\n    }\n  } else if (databaseUrl.startsWith('postgresql://') || databaseUrl.startsWith('postgres://')) {\n    // PostgreSQL - use adapter\n    try {\n      const { PrismaPg } = require('@prisma/adapter-pg');\n      const { Pool } = require('pg');\n      const pool = new Pool({ connectionString: databaseUrl });\n      const adapter = new PrismaPg(pool);\n      client = new PrismaClient({\n        adapter,\n        log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : [],\n      });\n    } catch (error) {\n      console.error('Failed to create postgres adapter:', error);\n      client = new PrismaClient({\n        log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : [],\n      });\n    }\n  } else {\n    // Default: try standard client\n    client = new PrismaClient({\n      log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : [],\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    globalForPrisma.prisma = client;\n  }\n\n  return client;\n}\n\n// Export a proxy that lazily initializes the client\nexport const prisma = new Proxy({} as PrismaClient, {\n  get(_target, prop) {\n    const client = getPrismaClient();\n    const value = (client as any)[prop];\n    if (typeof value === 'function') {\n      return value.bind(client);\n    }\n    return value;\n  },\n}) as PrismaClient;\n\nexport default prisma;\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAIxB,+DAA+D;AAC/D,SAAS;IACP,IAAI,gBAAgB,MAAM,EAAE;QAC1B,OAAO,gBAAgB,MAAM;IAC/B;IAEA,oCAAoC;IACpC,MAAM,iBAAiB,QAAQ,GAAG,CAAC,YAAY;IAC/C,IAAI,CAAC,kBAAkB,OAAO,mBAAmB,UAAU;QACzD,MAAM,IAAI,MAAM;IAClB;IAEA,oCAAoC;IACpC,IAAI;IACJ,IAAI;QACF,cAAc,OAAO,gBAAgB,IAAI;QACzC,IAAI,aAAa;YACf,cAAc,YAAY,OAAO,CAAC,gBAAgB;QACpD;IACF,EAAE,OAAO,OAAO;QACd,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,OAAO;IAC1D;IAEA,IAAI,CAAC,aAAa;QAChB,MAAM,IAAI,MAAM;IAClB;IACA,IAAI;IAEJ,IAAI,eAAe,YAAY,UAAU,CAAC,UAAU;QAClD,8DAA8D;QAC9D,IAAI;YACF,MAAM,EAAE,mBAAmB,EAAE;YAC7B,MAAM;YACN,MAAM;YAEN,0CAA0C;YAC1C,sFAAsF;YACtF,IAAI,SAAS,YAAY,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,QAAQ;YAChE,SAAS,OAAO,OAAO,CAAC,gBAAgB,KAAK,gBAAgB;YAE7D,wBAAwB;YACxB,IAAI,OAAO,UAAU,CAAC,OAAO;gBAC3B,SAAS,OAAO,SAAS,CAAC;YAC5B;YAEA,2BAA2B;YAC3B,MAAM,eAAe,KAAK,OAAO,CAAC,QAAQ,GAAG,IAAI;YAEjD,wDAAwD;YACxD,MAAM,UAAU,IAAI,oBAAoB;gBACtC,KAAK;YACP;YAEA,SAAS,IAAI,6IAAY,CAAC;gBACxB;gBACA,KAAK,uCAAyC;oBAAC;oBAAS;iBAAO,GAAG;YACpE;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,6CAA6C;YAC3D,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,QAAQ,KAAK,CAAC,kBAAkB,OAAO,SAAS,OAAO;YACvD,MAAM,IAAI,MAAM,CAAC,yCAAyC,EAAE,OAAO,WAAW,OAAO;QACvF;IACF,OAAO,IAAI,YAAY,UAAU,CAAC,oBAAoB,YAAY,UAAU,CAAC,gBAAgB;QAC3F,2BAA2B;QAC3B,IAAI;YACF,MAAM,EAAE,QAAQ,EAAE;YAClB,MAAM,EAAE,IAAI,EAAE;YACd,MAAM,OAAO,IAAI,KAAK;gBAAE,kBAAkB;YAAY;YACtD,MAAM,UAAU,IAAI,SAAS;YAC7B,SAAS,IAAI,6IAAY,CAAC;gBACxB;gBACA,KAAK,uCAAyC;oBAAC;oBAAS;iBAAO,GAAG;YACpE;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,SAAS,IAAI,6IAAY,CAAC;gBACxB,KAAK,uCAAyC;oBAAC;oBAAS;iBAAO,GAAG;YACpE;QACF;IACF,OAAO;QACL,+BAA+B;QAC/B,SAAS,IAAI,6IAAY,CAAC;YACxB,KAAK,uCAAyC;gBAAC;gBAAS;aAAO,GAAG;QACpE;IACF;IAEA,wCAA2C;QACzC,gBAAgB,MAAM,GAAG;IAC3B;IAEA,OAAO;AACT;AAGO,MAAM,SAAS,IAAI,MAAM,CAAC,GAAmB;IAClD,KAAI,OAAO,EAAE,IAAI;QACf,MAAM,SAAS;QACf,MAAM,QAAQ,AAAC,MAAc,CAAC,KAAK;QACnC,IAAI,OAAO,UAAU,YAAY;YAC/B,OAAO,MAAM,IAAI,CAAC;QACpB;QACA,OAAO;IACT;AACF;uCAEe"}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/TECHNOSOFT/Downloads/test-main/PCE_Assistant-main/app/api/admin/client-users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const userType = searchParams.get('userType');\n\n    // Build filter\n    const where: any = {};\n    if (userType) {\n      const validUserTypes = ['student', 'guest', 'parent'];\n      if (!validUserTypes.includes(userType.toLowerCase())) {\n        return NextResponse.json(\n          { error: 'Invalid userType filter. Must be: student, guest, or parent' },\n          { status: 400 }\n        );\n      }\n      where.userType = userType.toLowerCase();\n    }\n\n    // Fetch client users\n    const clientUsers = await prisma.clientUser.findMany({\n      where,\n      orderBy: { createdAt: 'desc' },\n    });\n\n    return NextResponse.json(\n      {\n        success: true,\n        count: clientUsers.length,\n        users: clientUsers,\n      },\n      { status: 200 }\n    );\n  } catch (error: any) {\n    console.error('Error fetching client users:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch client users', details: error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,eAAe;QACf,MAAM,QAAa,CAAC;QACpB,IAAI,UAAU;YACZ,MAAM,iBAAiB;gBAAC;gBAAW;gBAAS;aAAS;YACrD,IAAI,CAAC,eAAe,QAAQ,CAAC,SAAS,WAAW,KAAK;gBACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAA8D,GACvE;oBAAE,QAAQ;gBAAI;YAElB;YACA,MAAM,QAAQ,GAAG,SAAS,WAAW;QACvC;QAEA,qBAAqB;QACrB,MAAM,cAAc,MAAM,0HAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;YACnD;YACA,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,YAAY,MAAM;YACzB,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAgC,SAAS,MAAM,OAAO;QAAC,GAChE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}